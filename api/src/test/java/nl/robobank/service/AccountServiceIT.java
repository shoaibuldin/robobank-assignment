package nl.robobank.service;import nl.rabobank.dto.AccountDTO;import nl.rabobank.mongo.model.UserModel;import nl.rabobank.mongo.repository.UserRepository;import nl.rabobank.service.account.AccountService;import nl.robobank.IntegrationTest;import nl.robobank.dummy.AccountDummy;import nl.robobank.dummy.UserDummy;import org.junit.jupiter.api.BeforeEach;import org.junit.jupiter.api.DisplayName;import org.junit.jupiter.api.Test;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;import org.springframework.security.core.Authentication;import org.springframework.security.core.context.SecurityContextHolder;import org.springframework.security.crypto.password.PasswordEncoder;import static org.assertj.core.api.Assertions.assertThat;@IntegrationTestpublic class AccountServiceIT {    private static final String USER_ONE_LOGIN = "test-user-one";    private static final String USER_ONE_PASSWORD = "password";    @Autowired    private AuthenticationManagerBuilder authenticationManagerBuilder;    @Autowired    private AccountService accountService;    @Autowired    private UserRepository userRepository;    @Autowired    private PasswordEncoder passwordEncoder;    @BeforeEach    public void init() {        userRepository.deleteAll();        UserModel userOne = UserDummy.fetchOneUser(USER_ONE_LOGIN, passwordEncoder.encode(USER_ONE_PASSWORD));        userRepository.save(userOne);        UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(                USER_ONE_LOGIN,                USER_ONE_PASSWORD        );        Authentication authentication = authenticationManagerBuilder.getObject().authenticate(authenticationToken);        SecurityContextHolder.getContext().setAuthentication(authentication);    }    @Test    @DisplayName("user is able to create a payment account")    void assertThatUserAbleToCreatePaymentAccount() throws Exception {        AccountDTO accountDTO = AccountDummy.fetchOnePaymentAccountDTO();        AccountDTO persistAccountDTO = accountService.save(accountDTO);        assertThat(persistAccountDTO).isNotNull();        assertThat(persistAccountDTO.getAccountNumber()).isEqualTo(accountDTO.getAccountNumber());    }    @Test    @DisplayName("user is able to create a savings account")    void assertThatUserAbleToCreateSavingAccount() throws Exception {        AccountDTO accountDTO = AccountDummy.fetchOneSavingsAccountDTO();        AccountDTO persistAccountDTO = accountService.save(accountDTO);        assertThat(persistAccountDTO).isNotNull();        assertThat(persistAccountDTO.getAccountNumber()).isEqualTo(accountDTO.getAccountNumber());    }}